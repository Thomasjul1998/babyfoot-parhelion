<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tournoi babyfoot Parhelion 11/12 — Inscription</title>
<style>
/* Ici tu peux garder le même CSS que ton précédent code */
</style>
</head>
<body>
<div class="container" role="main">
<header>
  <div class="title">
    <h1>tournoi babyfoot Parhelion 11/12</h1>
    <p class="lead">Inscription joueur — indique ton prénom et ton poste (attaque ou défense)</p>
  </div>
  <div class="controls">
    <button id="teamBtn" class="ghost">Former équipes</button>
  </div>
</header>

<form id="regForm" autocomplete="off">
  <div>
    <label for="prenom">Prénom</label>
    <input id="prenom" name="prenom" type="text" placeholder="Ex. Alice" required maxlength="40">
  </div>

  <div>
    <label>Poste</label>
    <div class="poste">
      <label for="attaque"><input id="attaque" type="radio" name="poste" value="Attaque" required> Attaque</label>
      <label for="defense"><input id="defense" type="radio" name="poste" value="Défense"> Défense</label>
    </div>
  </div>

  <div class="actions" style="grid-column:1/-1">
    <button type="submit">S'inscrire</button>
  </div>
</form>

<main>
<h3>Participants</h3>
<div id="listWrap">
  <div class="empty">Chargement...</div>
</div>

<h3>Équipes générées</h3>
<div id="teamsWrap">
  <div class="empty">Aucune équipe générée</div>
</div>
</main>
</div>

<script>
const form = document.getElementById('regForm');
const prenomInput = document.getElementById('prenom');
const listWrap = document.getElementById('listWrap');
const teamBtn = document.getElementById('teamBtn');
const teamsWrap = document.getElementById('teamsWrap');

// === CONFIG ===
const SHEETMONKEY_KEY = '<TON_KEY_SHEETMONKEY>'; // remplace par ta clé
const SHEETMONKEY_API = `https://api.sheetmonkey.io/api/${SHEETMONKEY_KEY}`;
const SHEETMONKEY_FORM = `https://api.sheetmonkey.io/form/${SHEETMONKEY_KEY}`;

// Charger la liste depuis Google Sheet
async function loadList() {
  try {
    const res = await fetch(SHEETMONKEY_API);
    const data = await res.json();
    return data.map(r => ({ prenom: r.Prénom, poste: r.Poste }));
  } catch(e) {
    console.error(e);
    return [];
  }
}

// Afficher la liste
async function renderList() {
  const list = await loadList();
  if(!list.length){
    listWrap.innerHTML = '<div class="empty">Aucun participant pour l\'instant</div>';
    return;
  }
  const rows = list.map(p => `<tr><td>${p.prenom}</td><td>${p.poste}</td></tr>`).join('');
  listWrap.innerHTML = `<table>
    <thead><tr><th>Prénom</th><th>Poste</th></tr></thead>
    <tbody>${rows}</tbody>
  </table>`;
}

// Soumettre le formulaire
form.addEventListener('submit', async e => {
  e.preventDefault();
  const prenom = prenomInput.value.trim();
  const poste = form.elements['poste'].value;
  if(!prenom || !poste) return;

  // Envoi vers SheetMonkey
  try {
    await fetch(SHEETMONKEY_FORM, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ Prénom: prenom, Poste: poste })
    });
    form.reset();
    renderList();
  } catch(e) {
    alert('Erreur lors de l’inscription, réessayez.');
    console.error(e);
  }
});

// Former les équipes
teamBtn.addEventListener('click', async () => {
  const list = await loadList();
  if(list.length < 2){
    teamsWrap.innerHTML = '<div class="empty">Pas assez de participants</div>';
    return;
  }
  let attaquants = list.filter(p => p.poste === 'Attaque').sort(() => Math.random()-0.5);
  let defenseurs = list.filter(p => p.poste === 'Défense').sort(() => Math.random()-0.5);
  let html = '';
  while(attaquants.length && defenseurs.length){
    const a = attaquants.shift();
    const d = defenseurs.shift();
    html += `<div class="team"><strong>Équipe :</strong> ${a.prenom} & ${d.prenom}</div>`;
  }
  [...attaquants, ...defenseurs].forEach(p => {
    html += `<div class="team"><strong>Participant sans équipe :</strong> ${p.prenom}</div>`;
  });
  teamsWrap.innerHTML = html;
});

// Initial
renderList();
</script>
</body>
</html>
